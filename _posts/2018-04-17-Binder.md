---
layout: post
title:  "Binder篇"
date:   2018-04-17
categories: jekyll update
---

Tags : ZAZE

---

[TOC]

---

# Binder篇

## 参考资料

以上部分图片和解读说明摘自以下参考资料。

### 链接

[为什么Android要采用Binder作为IPC机制][为什么Android要采用Binder作为IPC机制]

### 书籍

> **<< Android的设计和实现:卷I>>**
> **<<深入理解Android: 卷I>>**

## 一、 初窥Binder

### 1.1 什么是Binder

首先一句话概括 : ``Binder在Android中被用于进行进程间通信(IPC)``

```
Android 是使用Linux的进程管理机制， 以进程为单位分配虚拟地址空间。
为了安全考虑，一个进程禁止直接与其他进程交互,也就是不同进程之间是相互隔离的(Process Isolation)。
这时候如果需要进行通信，就必须通过Linux内核提供的进程间通讯(Inter Process Communication, IPC),具体的通信方式看下方。但是这些IPC方式要么效率低下，要么不适合封装给上层使用, 所以在Android 中并没有大规模使用，取而代之的使用Binder。
```
```
Binder是Android对Linux内核层的一个扩展。
Android通过对Binder的封装，提供了一套Binder操作的框架，便于上层使用。
Binder框架分成Native层和Java层。
```

### 1.2 IPC机制了解一下

```
- Socket(套接字) ： 主要用于不通机器或跨网络的通信，传输效率低
- Signal(信号) ： 适用于进程中断控制，比如非法内存访问，杀死某个进程等
- Pipe(管道) ： 在创建时分配一个page大小的内存，缓存区大小比较有限
- Message Queue ： 信息复制两次，额外的CPU消耗；不合适频繁或信息量大的通信
- Semaphore(信号量) : 常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段
- Shared Memory(共享内存) : 无须复制，共享缓冲区直接付附加到进程虚拟地址空间，速度快；但进程间的同步问题操作系统无法实现，必须各进程利用同步工具解决；
....等等
```


### 1.3 Binder与C/S体系结构体会一下

```
- 用户端(Client) : 是C/S体系结构中使用Server端提供的Service的一方
- 服务端(Server) : 是C/S体系结构中为Client端提供Service的一方
- 服务代理(Proxy): 位于Client端, 提供访问服务的接口。主要作用是屏蔽用户端和Server端通讯的细节, 如对请求数据的序列化和对响应数据的反序列化、通信协议的处理等。
- 服务(Service): 运行在Server端，提供具体的功能处理Client端的请求。
- 服务存根(Stub): 位于Server端, 屏蔽了Proxy和Service端通信的细节，对Client端Proxy请求数据的反序列化和对Server端响应数据的序列化、通信协议的封装和处理、匹配Client端调用Service的具体方法，可以看作是Service的代理
- 通信协议：Client端和Server端可以运行于不同的进程中，甚至可以在不同的主机中，因此需要提供远程通信功能。在Android中，主要使用Binder作为Client端与Server端通信的协议。
```

### 1.4 ServiceManager

```
在Android的C/S体系结构中增加了一个额外的组件ServiceManager, 提供了Service注册和Service检索功能。
Service在启动过程中将自身信息注册到ServiceManager中,因此ServiceManager中维护了一个Service信息的列表。当Client要使用服务时，只需向ServiceManager提供所需Service的名字便可获取Service信息。ServiceManager是由init启动的进程，本身也是一个Server。
```
```
ServiceManager是在init.rc中配置的Daemon System Service, 由boot Action 启动。ServiceManager优先于其他服务启动，在其启动后， 便可以对外提供服务注册、服务检索的功能。除此之外，它还维护了一个Binder通讯的上下文管理者(context manager)。
```

![image_1cbjv1brnoa21sc21coacpb1rtrm.png-187.2kB][C/S和ServiceManager]

[back](./)

------
作者 : [口戛口崩月危.Z][author]

[author]: https://zaze359.github.io
[为什么Android要采用Binder作为IPC机制]:https://www.zhihu.com/question/39440766/answer/89210950
[C/S和ServiceManager]: http://static.zybuluo.com/zaze/hd4k8fd8y0ky6lljv86bwkd9/image_1cbjv1brnoa21sc21coacpb1rtrm.png